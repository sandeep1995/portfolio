function saveTask(a,b){$.post("http://ec2-54-172-129-63.compute-1.amazonaws.com:3000/api/saveTask",{addedBy:currentUId,url:a},function(a){console.log(a),Materialize.toast("We will notify you when price changes",4e3,"rounded",function(){Materialize.toast("Current Price: "+b,4e3,"rounded")}),updateUi(currentUId)})}function updateUi(a){var b=$("#urls");b.html(""),$.get("http://ec2-54-172-129-63.compute-1.amazonaws.com:3000/api/task/"+a,function(a){if(a.error)return Materialize.toast(a.message,3e3,"rounded");console.log(a);var c="";a.forEach(function(a){c+='<tr><td style="border-right: 1px solid #ccc"><img src="'+a.img+'" height="100"></td><td>'+a.name.substring(0,a.name.length<55?a.name.length:55)+'</td><td style="border-left: 1px solid #ccc"><b style="padding: 1.5em">'+a.price+'</b></td><td style="border-right: 1px solid #ccc">'+a.merchant+'</td><td style="padding: 1em;"><a href="'+a.url+'" target="_blank" class="btn-floating waves-effect waves-light red"><i class="material-icons">shop</i></a></td></tr>'}),b.html(c)})}function onHitPlus(a,b){loader.fadeIn(),Materialize.toast("Wow Great! Let's our bot do some work",2e3,"rounded",function(){Materialize.toast("They are lazy. It may take upto 30 seconds",3e3,"rounded")}),$.ajax({type:"GET",url:"http://ec2-54-172-129-63.compute-1.amazonaws.com:3000/api/"+a+"?url="+b,timeout:3e4,success:function(a){return a.error?Materialize.toast("Oops! Are you sure about this url?",4e3,"rounded"):void saveTask(b,a.price)},error:function(a){Materialize.toast("Oops! Are you sure about this url?",4e3,"rounded")},complete:function(){$("#url").val(""),loader.fadeOut()}})}var currentUId=null,authController=$("#firebaseui-auth-container"),logoutBtn=$(".logout"),loggedIn=$("#loggedIn"),nav=$("#nav"),userName=$(".user-name"),loader=$(".indeterminate");loader.hide(),nav.hide(),loggedIn.hide();var welcome=$("#welcome");initApp=function(){firebase.auth().onAuthStateChanged(function(a){if(!a||a.uid!=currentUId)if(a){currentUId=a.uid,welcome.fadeOut(),authController.fadeOut(),nav.slideDown(),loggedIn.slideDown(),logoutBtn.slideDown(),userName.html(a.displayName),updateUi(currentUId),$("#add").click(function(a){var b=$("#url").val();""!=b&&(b.indexOf("flipkart")!=-1?onHitPlus("flipkart",b):b.indexOf("amazon")!=-1?onHitPlus("amazon",b):b.indexOf("ebay")!=-1?onHitPlus("ebay",b):b.indexOf("snapdeal")!=-1?onHitPlus("snapdeal",b):b.indexOf("myntra")!=-1?onHitPlus("myntra",b):($("#url").val(""),Materialize.toast("Oops! We do not support this url",4e3,"rounded")))});var b=firebase.messaging();b.requestPermission().then(function(){return console.log("Notification permission granted."),b.getToken()}).then(function(a){console.log(a),$.post("http://ec2-54-172-129-63.compute-1.amazonaws.com:3000/api/saveToken",{uid:currentUId,token:a},function(a){Materialize.toast(a.message,3e3,"rounded")})}).catch(function(a){console.log("Unable to get permission to notify.",a),Materialize.toast("Please allow us to send notification",3e3,"rounded")}),b.onTokenRefresh(function(){b.getToken().then(function(a){console.log("Token refreshed.",a),$.post("http://ec2-54-172-129-63.compute-1.amazonaws.com:3000/api/saveToken",{uid:currentUId,token:a},function(a){Materialize.toast(a.message,3e3,"rounded")})}).catch(function(a){console.log("Unable to retrieve refreshed token ",a)})}),b.onMessage(function(a){var b=a.notification.body;Materialize.toast(b,5e3)})}else nav.fadeOut(),loggedIn.fadeOut(),authController.fadeIn(),welcome.fadeIn()},function(a){console.log(a),authController.fadeIn(),welcome.fadeIn()})},logoutBtn.on("click",function(){firebase.auth().signOut()}),window.addEventListener("load",function(){initApp()});
